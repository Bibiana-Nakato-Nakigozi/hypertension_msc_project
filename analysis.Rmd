---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
plot(cars)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
```{r}
library(dplyr)
library(readxl)
library(ggplot2)
```

```{r}
# Loading all sheets of the dummy dataset

#with Undiagnosed hypertension
hypertension_withundiagnosed <- read_excel("C:/Users/bibia/OneDrive/Masters Personal Project/dummy_datasets.xlsx", sheet = 1)

#Without Undiagnosed HYPERTENSION
hypertension_woutundiagnosed <- read_excel("C:/Users/bibia/OneDrive/Masters Personal Project/dummy_datasets.xlsx", sheet = 2)

#with Uncontrolled hypertension
hypertension_withuncontrolled <- read_excel("C:/Users/bibia/OneDrive/Masters Personal Project/dummy_datasets.xlsx", sheet = 3)

#without Uncontrolled hypertension
hypertension_woutcontrolled <- read_excel("C:/Users/bibia/OneDrive/Masters Personal Project/dummy_datasets.xlsx", sheet = 4)

```


```{r}
#exploring the with undiagnosed data

str(hypertension_withundiagnosed)

summary(hypertension_withundiagnosed)

# Check for missing values
colSums(is.na(hypertension_withundiagnosed))


```

```{r}
# Plot for categorical variable (agegroup)
ggplot(hypertension_withundiagnosed, aes(x = AgeGroup)) +
  geom_bar(fill = "blue", color = "black") +
  labs(title = "Distribution of Age Groups", x = "AgeGroup", y = "Count")

```

```{r}
# Pie chart of age groups
ggplot(hypertension_withundiagnosed, aes(x = "", fill = BMI)) +
  geom_bar(width = 1, stat = "count") +
  coord_polar(theta = "y") +
  labs(title = "Distribution of BMI") +
  theme_void()

```

```{r}
# Converting Age to a factor if it's categorical (if needed)
hypertension_withundiagnosed$AgeGroup <- as.factor(hypertension_withundiagnosed$AgeGroup)

# Creating a bar plot for Age (as categorical/factor data)
ggplot(hypertension_withundiagnosed, aes(x = AgeGroup)) +
  geom_bar(fill = "blue", color = "black", alpha = 0.7) +
  labs(title = "Age Distribution", x = "Age Group", y = "Count") +
  theme_minimal()

# Converting Age to a factor if it's categorical (if needed)
hypertension_woutundiagnosed$BMI <- as.factor(hypertension_woutundiagnosed$BMI)

# Selecting numeric variables
numeric_vars <- hypertension_withundiagnosed %>% select(hypertension_withundiagnosed$AgeGroup, hypertension_woutundiagnosed$BMI)

# Correlation matrix
cor_matrix <- cor(numeric_vars, use = "complete.obs")

# correlation matrix
ggcorrplot(cor_matrix, method = "circle", lab = TRUE) +
  labs(title = "Correlation Matrix for Numeric Variables")

```


```{r}
#UNDIAGNOSED HYPERTENSION

#BMI and Age Group

# Converting BMI to a factor
hypertension_withundiagnosed$BMI <- as.factor(hypertension_withundiagnosed$BMI)
# Creating a contingency table between AgeGroup and BMI
contingency_table <- table(hypertension_withundiagnosed$AgeGroup, hypertension_withundiagnosed$BMI)
print(contingency_table)

#ETHNICITY AND BMI
# Converting Ethnicity to a factor
hypertension_withundiagnosed$Ethnicity <- as.factor(hypertension_withundiagnosed$Ethnicity)
hypertension_withundiagnosed$BMI <- as.factor(hypertension_withundiagnosed$BMI)

# Creating a contingency table between AgeGroup and BMI
contingency_table <- table(hypertension_withundiagnosed$BMI, hypertension_withundiagnosed$Ethnicity)
print(contingency_table)

#ALCOHOL CONSUMPTION AND ETHNICITY
# Converting Ethnicity to a factor
hypertension_withundiagnosed$Ethnicity <- as.factor(hypertension_withundiagnosed$Ethnicity)
hypertension_withundiagnosed$AlcoholConsumption <- as.factor(hypertension_withundiagnosed$AlcoholConsumption)

# Creating a contingency table between AgeGroup and BMI
contingency_table <- table(hypertension_withundiagnosed$AlcoholConsumption, hypertension_withundiagnosed$Ethnicity)
print(contingency_table)

ggplot(hypertension_withundiagnosed, aes(x = AlcoholConsumption)) +
  geom_bar(fill = "blue", color = "black", alpha = 0.7) +
  labs(title = "Alcohol Consumption Distribution", x = "Alcohol Consumption", y = "Count") +
  theme_minimal()
```



```{r}

# Converting AgeGroup to a factor
hypertension_withundiagnosed$AgeGroup <- as.factor(hypertension_withundiagnosed$AgeGroup)

# Creating a bar plot for AgeGroup
ggplot(hypertension_withundiagnosed, aes(x = AgeGroup)) +
  geom_bar(fill = "blue", color = "black", alpha = 0.7) +
  labs(title = "Age Group Distribution", x = "Age Group", y = "Count") +
  theme_minimal()

# Converting BMI to a factor
hypertension_withundiagnosed$BMI <- as.factor(hypertension_withundiagnosed$BMI)

# Creating a grouped bar plot for AgeGroup and BMI
ggplot(hypertension_withundiagnosed, aes(x = AgeGroup, fill = BMI)) +
  geom_bar(position = "dodge", color = "black") +
  labs(title = "Age Group vs BMI", x = "Age Group", y = "Count") +
  theme_minimal()

# Contingency table for AgeGroup and BMI
contingency_table <- table(hypertension_withundiagnosed$AgeGroup, hypertension_withundiagnosed$BMI)
print(contingency_table)

# Chi-square test for association between AgeGroup and BMI
chi_square_test <- chisq.test(contingency_table)
print(chi_square_test)



```


```{r}
#WITHOUT UNDIAGONISED HYPERTENSION

summary(hypertension_woutundiagnosed)
```

```{r}
#AGE GROUP, BMI, ETHNICITY AND EDUCATION 

# WITHOUT UNDIAGNOSED AND UNCONTROLLED HYPERTENSION

#AGE GROUP
#Age distribution of both with diagnosed and undiagnosed

# Adding a column to distinguish diagnosed from undiagnosed
hypertension_woutundiagnosed$Dataset <- "withoutundiagnosed"
hypertension_withuncontrolled$Dataset <- "withuncontrolled"

diagnosed <- rbind(hypertension_woutundiagnosed, hypertension_withuncontrolled)

# Grouped bar plot to compare AgeGroup distribution across two datasets
ggplot(diagnosed, aes(x = AgeGroup, fill = Dataset)) +
  geom_bar(position = "dodge", color = "black") +
  labs(title = "Comparison of Age Group Distribution Between without Undiagnosed and Uncontrolled", 
       x = "Age Group", y = "Count") +
  theme_minimal()

#BMI
# contingency table without undiagnosed 
print('without undiagnosed')
table(hypertension_woutundiagnosed$BMI)

# contingency table without uncontrolled
print('with uncontrolled')
table(hypertension_withuncontrolled$BMI)

#ETHNICITY
#ETHNICITY - Combining the datasets for visualisation
hypertension_woutundiagnosed$Dataset <- "withoutundiagnosed"
hypertension_withuncontrolled$Dataset <- "withcontrolled"

# Combining the two datasets
diagnosed <- rbind(hypertension_woutundiagnosed, hypertension_withuncontrolled)

# Convering Ethnicity to factor if it's not already
diagnosed$Ethnicity <- as.factor(diagnosed$Ethnicity)

# Grouped bar plot to compare Ethnicity distribution across the two datasets
ggplot(diagnosed, aes(x = Ethnicity, fill = Dataset)) +
  geom_bar(position = "dodge", color = "black") +
  labs(title = "Comparison of Ethnicity Distribution Between Without Undiagnosed and Uncontrolled", 
       x = "Ethnicity", y = "Count") +
  theme_minimal()

#EDUCATION
# Pie Chart for Undiagnosed Hypertension
woutundiagnosed_education <- table(hypertension_woutundiagnosed$Education)
pie(woutundiagnosed_education, 
    main = "Education Distribution in Undiagnosed Hypertension", 
    col = rainbow(length(woutundiagnosed_education)))

# Pie Chart for Uncontrolled Hypertension
uncontrolled_education <- table(hypertension_withuncontrolled$Education)
pie(uncontrolled_education, 
    main = "Education Distribution in Uncontrolled Hypertension", 
    col = rainbow(length(uncontrolled_education)))


```

```{r}
#AGE GROUP, BMI, ETHNICITY AND EDUCATION 

# WITHOUT UNDIAGNOSED AND WITHOUT UNCONTROLLED HYPERTENSION

#AGE GROUP
#Age distribution of both with diagnosed and without uncontrolled

# Adding a column to distinguish diagnosed from undiagnosed
hypertension_woutundiagnosed$Dataset <- "withoutundiagnosed"
hypertension_woutcontrolled$Dataset <- "withuncontrolled"

diagnosed <- rbind(hypertension_woutundiagnosed, hypertension_woutcontrolled)

# Grouped bar plot to compare AgeGroup distribution across two datasets
ggplot(diagnosed, aes(x = AgeGroup, fill = Dataset)) +
  geom_bar(position = "dodge", color = "black") +
  labs(title = "Comparison of Age Group Distribution Between without Undiagnosed and Uncontrolled", 
       x = "Age Group", y = "Count") +
  theme_minimal()

#BMI
# contingency table without undiagnosed 
print('without undiagnosed')
table(hypertension_woutundiagnosed$BMI)

# contingency table without uncontrolled
print('with uncontrolled')
table(hypertension_woutcontrolled$BMI)

#ETHNICITY
#ETHNICITY - Combining the datasets for visualisation
hypertension_woutundiagnosed$Dataset <- "withoutundiagnosed"
hypertension_woutcontrolled$Dataset <- "withcontrolled"

# Combining the two datasets
diagnosed <- rbind(hypertension_woutundiagnosed, hypertension_woutcontrolled)

# Converingt Ethnicity to factor if it's not already
diagnosed$Ethnicity <- as.factor(diagnosed$Ethnicity)

# Grouped bar plot to compare Ethnicity distribution across the two datasets
ggplot(diagnosed, aes(x = Ethnicity, fill = Dataset)) +
  geom_bar(position = "dodge", color = "black") +
  labs(title = "Comparison of Ethnicity Distribution Between Without Undiagnosed and Uncontrolled", 
       x = "Ethnicity", y = "Count") +
  theme_minimal()

#EDUCATION
# Pie Chart for Undiagnosed Hypertension
woutundiagnosed_education <- table(hypertension_woutundiagnosed$Education)
pie(woutundiagnosed_education, 
    main = "Education Distribution in Undiagnosed Hypertension", 
    col = rainbow(length(woutundiagnosed_education)))

# Pie Chart for Uncontrolled Hypertension
uncontrolled_education <- table(hypertension_woutcontrolled$Education)
pie(uncontrolled_education, 
    main = "Education Distribution in Uncontrolled Hypertension", 
    col = rainbow(length(uncontrolled_education)))

```



```{r}
#AGE GROUP, BMI, ETHNICITY AND EDUCATION 

# WITH UNDIAGNOSED AND UNCONTROLLED HYPERTENSION

#AGE GROUP
#Age distribution of both with diagnosed and undiagnosed

# Adding a column to distinguish diagnosed from undiagnosed
hypertension_withundiagnosed$Dataset <- "withundiagnosed"
hypertension_withuncontrolled$Dataset <- "withuncontrolled"

diagnosed <- rbind(hypertension_withundiagnosed, hypertension_withuncontrolled)

# Grouped bar plot to compare AgeGroup distribution across two datasets
ggplot(diagnosed, aes(x = AgeGroup, fill = Dataset)) +
  geom_bar(position = "dodge", color = "black") +
  labs(title = "Comparison of Age Group Distribution Between Undiagnosed and Uncontrolled", 
       x = "Age Group", y = "Count") +
  theme_minimal()

#BMI
# contingency table with undiagnosed 
print('with undiagnosed')
table(hypertension_withundiagnosed$BMI)

# contingency table with uncontrolled
print('with uncontrolled')
table(hypertension_withuncontrolled$BMI)

#ETHNICITY
#ETHNICITY - Combine the datasets for visualisation
hypertension_withundiagnosed$Dataset <- "withundiagnosed"
hypertension_withuncontrolled$Dataset <- "withuncontrolled"

# Combining the two datasets
diagnosed <- rbind(hypertension_withundiagnosed, hypertension_withuncontrolled)

# Converting Ethnicity to factor if it's not already
diagnosed$Ethnicity <- as.factor(diagnosed$Ethnicity)

# Grouped bar plot to compare Ethnicity distribution across the two datasets
ggplot(diagnosed, aes(x = Ethnicity, fill = Dataset)) +
  geom_bar(position = "dodge", color = "black") +
  labs(title = "Comparison of Ethnicity Distribution Between Undiagnosed and Uncontrolled", 
       x = "Ethnicity", y = "Count") +
  theme_minimal()

#EDUCATION
# Pie Chart for Undiagnosed Hypertension
undiagnosed_education <- table(hypertension_withundiagnosed$Education)
pie(undiagnosed_education, 
    main = "Education Distribution in Undiagnosed Hypertension", 
    col = rainbow(length(undiagnosed_education)))

# Pie Chart for Uncontrolled Hypertension
uncontrolled_education <- table(hypertension_withuncontrolled$Education)
pie(uncontrolled_education, 
    main = "Education Distribution in Uncontrolled Hypertension", 
    col = rainbow(length(uncontrolled_education)))

```

```{r}
#UNDIAGNOSED HYPERTENSION BELOW 44YRS
print('with undiagnosed')
table(hypertension_withundiagnosed$AgeGroup)

#WITHOUT UNDIAGNOSED HYPERTENSION BELOW 44YRS
print('without undiagnosed')
table(hypertension_woutundiagnosed$AgeGroup)


```

```{r}
# UNDIAGNOSED HYPERTENSION BELOW OR EQUAL TO 35-44YRS
print('With undiagnosed hypertension for age <= 35-44 years')
# Filtering and summing the relevant age groups
undiagnosed_agegroups <- c('16-24 years', '25-34 years', '35-44 years')
undiagnosed_subset <- table(hypertension_withundiagnosed$AgeGroup[hypertension_withundiagnosed$AgeGroup %in% undiagnosed_agegroups])
print(undiagnosed_subset)
total_undiagnosed <- sum(undiagnosed_subset)
print(paste("Total undiagnosed hypertension below or equal to 35-44 years:", total_undiagnosed))

# UNCONTROLLED HYPERTENSION BELOW OR EQUAL TO 35-44YRS
print('With uncontrolled hypertension for age <= 35-44 years')
# Filtering and summing the relevant age groups
uncontrolled_agegroups <- c('35-44 years')  # Since only '35-44 years' is present in this case
uncontrolled_subset <- table(hypertension_withuncontrolled$AgeGroup[hypertension_withuncontrolled$AgeGroup %in% uncontrolled_agegroups])
print(uncontrolled_subset)
total_uncontrolled <- sum(uncontrolled_subset)
print(paste("Total uncontrolled hypertension below or equal to 35-44 years:", total_uncontrolled))

```
```{r}


#  Ethnicity is a factor for proper plotting
hypertension_withundiagnosed$Ethnicity <- as.factor(hypertension_withundiagnosed$Ethnicity)


# Converting BMI to numeric (1-not overweight, 2- Obese, 3-Overweight)
hypertension_withundiagnosed$BMI <- as.numeric(hypertension_withundiagnosed$BMI)

# Filtering out the ethnicities
# Creating a new data frame that only includes the relevant ethnicities
ethnic_groups <- c("White", "Black", "Asian", "Other")
filtered_data <- hypertension_withundiagnosed %>% 
  filter(Ethnicity %in% ethnic_groups)

#  Box Plot for Each Ethnicity Group 
ggplot(filtered_data, aes(x = Ethnicity, y = BMI, fill = Ethnicity)) +
  geom_boxplot() +
  labs(title = "Comparison of BMI for Each Ethnicity Group", 
       x = "Ethnicity", y = "BMI") +
  theme_minimal() +
  scale_fill_manual(values = c("White" = "blue", "Black" = "green", "Asian" = "orange", "Other" = "purple"))

#  Violin Plot for Each Ethnicity Group 
ggplot(filtered_data, aes(x = Ethnicity, y = BMI, fill = Ethnicity)) +
  geom_violin() +
  labs(title = "Violin Plot: BMI Comparison for Each Ethnicity Group", 
       x = "Ethnicity", y = "BMI") +
  theme_minimal() +
  scale_fill_manual(values = c("White" = "blue", "Black" = "green", "Asian" = "orange", "Other" = "purple"))





```
```{r}
table(hypertension_withundiagnosed$Ethnicity)

table(hypertension_withundiagnosed$BMI)
```




```{r}
#ALCOHOL 

# Loading the dataset from the Excel file
hypertension_withundiagnosed <- read_excel("C:/Users/bibia/OneDrive/Masters Personal Project/dummy_datasets.xlsx", sheet = 1)

#with Uncontrolled hypertension
hypertension_withuncontrolled <- read_excel("C:/Users/bibia/OneDrive/Masters Personal Project/dummy_datasets.xlsx", sheet = 3)

# AlcoholConsumption and BMI columns format
hypertension_withundiagnosed$AlcoholConsumption <- as.factor(hypertension_withundiagnosed$AlcoholConsumption)
hypertension_withundiagnosed$BMI <- as.numeric(as.character(hypertension_withundiagnosed$BMI))

hypertension_withuncontrolled$AlcoholConsumption <- as.factor(hypertension_withuncontrolled$AlcoholConsumption)
hypertension_withuncontrolled$BMI <- as.numeric(as.character(hypertension_withuncontrolled$BMI))

# Checking for unique values of AlcoholConsumption
print(unique(hypertension_withundiagnosed$AlcoholConsumption))


# Creating a summary of the data by alcohol consumption category
alcohol_summary <- hypertension_withundiagnosed %>%
  group_by(AlcoholConsumption) %>%
  summarize(Count = n(), Average_BMI = mean(BMI, na.rm = TRUE))
print(alcohol_summary)

alcohol_summary2 <- hypertension_withuncontrolled %>%
  group_by(AlcoholConsumption) %>%
  summarize(Count = n(), Average_BMI = mean(BMI, na.rm = TRUE))
print(alcohol_summary2)

# Bar Plot for Alcohol Consumption Categories-Undiagnosed hypertension
ggplot(alcohol_summary, aes(x = AlcoholConsumption, y = Count, fill = AlcoholConsumption)) +
  geom_bar(stat = "identity") +
  labs(title = "Alcohol Consumption Categories of Undiagnosed Hypertension",
       x = "Alcohol Consumption Category", y = "Count") +
  theme_minimal() +
  scale_fill_brewer(palette = "Set1")

# Bar Plot for Alcohol Consumption Categories-Uncontrolled hypertension
ggplot(alcohol_summary2, aes(x = AlcoholConsumption, y = Count, fill = AlcoholConsumption)) +
  geom_bar(stat = "identity") +
  labs(title = "Alcohol Consumption Categories of Uncontrolled Hypertension",
       x = "Alcohol Consumption Category", y = "Count") +
  theme_minimal() +
  scale_fill_brewer(palette = "Set1")

```

```{r}


#AgeGroup, Ethnicity, and Region are factors
hypertension_withundiagnosed$AgeGroup <- as.factor(hypertension_withundiagnosed$AgeGroup)
hypertension_withundiagnosed$Ethnicity <- as.factor(hypertension_withundiagnosed$Ethnicity)
hypertension_withundiagnosed$Region <- as.factor(hypertension_withundiagnosed$Region)

# Creating a new column to group regions into four regions
hypertension_withundiagnosed <- hypertension_withundiagnosed %>%
  mutate(RegionGroup = case_when(
    Region %in% c("North East", "North West", "Yorkshire and the Humber") ~ "North",
    Region %in% c("South East", "South West", "London") ~ "South",
    Region %in% c("East Midlands", "East England") ~ "East",
    Region == "West Midlands" ~ "West",
    TRUE ~ "Other" 
  ))

# Filtering data for specific age groups
age_groups_to_analyze <- c("16-24 years", "25-34 years", "35-44 years")
filtered_data <- hypertension_withundiagnosed %>%
  filter(AgeGroup %in% age_groups_to_analyze)

# Counting the occurrences of each region group in the filtered age groups
age_region_summary <- filtered_data %>%
  group_by(AgeGroup, RegionGroup) %>%
  summarize(Count = n(), .groups = 'drop')

print(age_region_summary)

# a bar plot of Age Group vs Region Group
ggplot(age_region_summary, aes(x = AgeGroup, y = Count, fill = RegionGroup)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Distribution of Age Groups Across Region Groups",
       x = "Age Group", y = "Count") +
  theme_minimal() +
  scale_fill_brewer(palette = "Set1")

```

